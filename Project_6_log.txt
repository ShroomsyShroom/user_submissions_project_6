--USER SUBMISSIONS Analysis--

1. CREATE a database in PostgreSQL
2. In the newdatabase, Create a table.

Code:

CREATE TABLE user_submissions (
	id SERIAL PRIMARY KEY,
	user_id BIGINT,
	question_id INT,
	points INT,
	submitted_at TIMESTAMP WITH TIME ZONE,
	username VARCHAR(50)
);

SELECT * FROM user_submissions;

3. Now in this table so created, import the data from your dataset.

4. Now we may perform exploratory actions on this dataset.

So, these are the major questions we'll answer:

Q1. List All Distinct Users and Their Stats
Description: Return the user name, total submissions, and total points earned by each user.
Expected Output: A list of users with their submission count and total points.

Code:

SELECT 
	username, 
	COUNT(id) as total_submission,
	SUM(points) as points_earned
FROM user_submissions
GROUP BY 1;


Q2. Calculate the Daily Average Points for Each User
Description: For each day, calculate the average points earned by each user.
Expected Output: A report showing the average points per user for each day.

Code:

SELECT 
	TO_CHAR(submitted_at, 'DD-MM') AS day,
	username,
	AVG(points) AS daily_average_points
FROM user_submissions
GROUP BY 1,2;

Q3. Find the Top 3 Users with the Most Correct Submissions for Each Day
Description: Identify the top 3 users with the most correct submissions for each day.
Expected Output: A list of users and their correct submissions, ranked daily.

Code:


WITH daily_submission 
AS
	(SELECT 
		TO_CHAR(submitted_at, 'DD-MM') AS daily,
		username,
		SUM(CASE 
			WHEN points > 0 THEN 1 ELSE 0 
		END) AS total_correct_submissions
	FROM user_submissions
	GROUP BY 1,2
	),
users_rank
AS
	(SELECT 
		daily, 
		username,
		total_correct_submissions,
		DENSE_RANK() OVER ( PARTITION BY daily ORDER BY total_correct_submissions DESC) AS submission_rank
	FROM daily_submission
	)

SELECT 
	daily, 
	username,
	total_correct_submissions,
	submission_rank
FROM users_rank
WHERE submission_rank <= 3;


Q4. Find the Top 5 Users with the Highest Number of Incorrect Submissions
Description: Identify the top 5 users with the highest number of incorrect submissions.
Expected Output: A list of users with the count of incorrect submissions.

Code:


SELECT 
	username,
	SUM(CASE WHEN points < 0 THEN 1 ELSE 0 END) AS total_incorrect_submissions
FROM user_submissions
GROUP BY 1
ORDER BY total_incorrect_submissions DESC
LIMiT 5;



Q5. Find the Top 10 Performers for Each Week
Description: Identify the top 10 users with the highest total points earned each week.
Expected Output: A report showing the top 10 users ranked by total points per week.

Code:

SELECT * FROM 
	(
	SELECT
		EXTRACT(WEEK FROM submitted_at) AS week_no,
		username,
		SUM(points) AS total_points,
		DENSE_RANK() OVER(PARTITION BY EXTRACT(WEEK FROM submitted_at) ORDER BY SUM(points) DESC) AS rankings
	FROM user_submissions
	GROUP BY 1, 2
	ORDER BY week_no, total_points DESC
	)
WHERE rankings <= 10;

5. With that we're done with the EDA.